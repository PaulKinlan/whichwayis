<!DOCTYPE HTML>
<html>
  <head>
    <title>Which way is</title>
    <meta name="viewport" content="width=device-width; height=device-height; user-scalable=no" />
    <script type="text/javascript" charset="utf-8" src="cordova-1.7.0.js"></script>
    <style>
      .requesting {
        display: none;
      }

      .locationCapturing {

      }

      .locationCapturing .requesting {
        display: block;
      }

      .locationCaptured {

      }

      .locationCaptureFailed {

      }
    </style>
    <script>
      var getLocation = function(error, next) {
        var onSuccess = function(pos) {
          var coords = pos.coords;
          next({ latitude: coords.latitude, longitude: coords.longitude, heading: coords.heading }); 
        };
        var onFailure = function() {
          error();
        };

        navigator.geolocation.getCurrentPosition(onSuccess, onFailure, {enableHighAccuracy: true});
      };

      var changeUIState = function(state) {
        window.document.body.className = state;
      };

      var updateLocationUI = function(coords) {
        var mapimgSrc = document.getElementById("pointer");
        var apiKey = "";

        mapimgSrc.style.backgroundImage = "url(http://maps.google.com/maps/api/staticmap?center=" + coords.latitude + "," + coords.longitude + "&zoom=13&size=320x480&maptype=roadmap&key=" + apiKey + ");";
                                
        changeUIState("locationCaptured");
      };

      var errorCapturing = function() {
        changeUIState("locationCaptureFailed");
      };

      var fetchTargetLocation = function(target, targetCallback) {
        // Do Magic.

        // Calculate direction
        
        targetCallback();
      };

      window.addEventListener("load", function() {
        changeUIState("locationCapturing");

        getLocation(updateLocationUI, errorCapturing);

        var requestedLocation = document.getElementById("requestedLocation");
        requestedLocation.onchange = function(e) {
          fetchTargetLocation(requestedLocation.value, updateTargetUI);
        };

        var requestTarget = document.getElementByUd("requestTarget");
        requestTarget.onclick = function(e) {
          fetchTargetLocation(requestedLocation.value, updateTargetUI);
        };
      });

    </script>
  </head>
  <body>
    <div id="heading">
      <input type="search" id="requestedLocation" />
      <input type="button" id="requestTarget" />
    </div>
    <div id="pointer">
      <p class="requesting">Waiting for location</p>
    </div>
  </body>
</html>
